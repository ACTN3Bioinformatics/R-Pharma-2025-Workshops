---
title: "Introduction to Building (Better) R Packages"
subtitle: "From scripts to packages: Making your code reusable and shareable"
author: "Nicola Rennie (Data Visualisation Specialist)"
categories: [Development, Packages, Beginner]
---

## Overview

[Beginner Friendly]{.badge .badge-beginner} [Package Development]{.badge .badge-category} [Best Practices]{.badge .badge-category}

Transform your R scripts into professional packages! Learn the fundamentals of package development, from basic structure to documentation, testing, and sharing. **By the end of this workshop, you will have made an R package!**

### What You'll Learn

-   ğŸ“¦ **Package structure** - Essential components
-   ğŸ”§ **Writing functions** - Package-friendly style
-   ğŸ“ **Documentation** - roxygen2 and examples
-   âœ… **Testing** - Ensuring code quality
-   ğŸŒ **Sharing** - GitHub and CRAN
-   ğŸ’¡ **Best practices** - Professional development

## Prerequisites

::: requirements
**Required Knowledge:**

-   Basic R programming
-   No prior package development experience needed!
-   No function writing experience required!

**Setup:**

-   R and RStudio
-   `{devtools}` and `{usethis}` packages
:::

## Key Packages

::: tool-tag
{devtools}
:::

::: tool-tag
{usethis}
:::

::: tool-tag
{roxygen2}
:::

::: tool-tag
{testthat}
:::

::: tool-tag
{pkgdown}
:::

## Workshop Materials

::: callout-note
## Resources

**Slides:** [nrennie.rbind.io/r-pharma-2025-r-packages](https://nrennie.rbind.io/r-pharma-2025-r-packages/#/title-slide)
:::

## Why Build Packages?

### Benefits

-   â™»ï¸ **Reusability** - Use your code across projects
-   ğŸ¤ **Sharing** - Collaborate easily with others
-   ğŸ“š **Documentation** - Built-in help pages
-   âœ… **Testing** - Ensure code reliability
-   ğŸ¯ **Organization** - Structured project layout

## Workshop Structure

### Part 1: Package Basics (45 min)

**Creating Your First Package:**

``` r
library(usethis)

# Create package structure
create_package("~/mypackage")

# Your package now has:
# - DESCRIPTION file
# - NAMESPACE file
# - R/ directory
# - .Rproj file
```

**Essential Components:**

1.  **DESCRIPTION** - Package metadata
2.  **NAMESPACE** - Function exports
3.  **R/** - Function code
4.  **man/** - Documentation (auto-generated)

### Part 2: Writing Functions (45 min)

**Package-Friendly Function Style:**

``` r
# R/my_function.R

#' Calculate Summary Statistics
#'
#' @param x A numeric vector
#' @param na.rm Logical. Should missing values be removed?
#'
#' @return A named vector of summary statistics
#' @export
#'
#' @examples
#' calculate_summary(c(1, 2, 3, 4, 5))
#' calculate_summary(c(1, 2, NA, 4), na.rm = TRUE)
calculate_summary <- function(x, na.rm = FALSE) {
  if (!is.numeric(x)) {
    stop("`x` must be numeric")
  }
  
  c(
    mean = mean(x, na.rm = na.rm),
    sd = sd(x, na.rm = na.rm),
    min = min(x, na.rm = na.rm),
    max = max(x, na.rm = na.rm)
  )
}
```

**Best Practices:**

-   âœ… Clear function names
-   âœ… Input validation
-   âœ… Informative error messages
-   âœ… Consistent parameter names
-   âœ… Return predictable output

### Part 3: Documentation (30 min)

**roxygen2 Documentation:**

``` r
# Use roxygen2 comments above functions
#' (starts with #')
#' 
#' @param parameter_name Description
#' @return What the function returns
#' @export Makes function available to users
#' @examples Usage examples

# Generate documentation
devtools::document()
```

**Creating README:**

``` r
use_readme_md()
```

### Part 4: Testing (30 min)

**Setting Up Tests:**

``` r
# Initialize testing infrastructure
usethis::use_testthat()

# Create test file
usethis::use_test("my_function")
```

**Writing Tests:**

``` r
# tests/testthat/test-my_function.R

test_that("calculate_summary works correctly", {
  x <- c(1, 2, 3, 4, 5)
  result <- calculate_summary(x)
  
  expect_equal(result["mean"], 3)
  expect_equal(result["sd"], sd(x))
  expect_length(result, 4)
})

test_that("calculate_summary handles NA values", {
  x <- c(1, 2, NA, 4)
  
  expect_true(is.na(calculate_summary(x)["mean"]))
  expect_false(is.na(calculate_summary(x, na.rm = TRUE)["mean"]))
})

test_that("calculate_summary validates input", {
  expect_error(calculate_summary("not numeric"))
})
```

### Part 5: Sharing Your Package (30 min)

**GitHub:**

``` r
# Initialize git
usethis::use_git()

# Connect to GitHub
usethis::use_github()
```

**Package Website:**

``` r
# Create pkgdown site
usethis::use_pkgdown()
pkgdown::build_site()
```

**CRAN Preparation:**

``` r
# Check package
devtools::check()

# Spell check
devtools::spell_check()

# Check for CRAN policies
rcmdcheck::rcmdcheck()
```

## Pharmaceutical Package Considerations

### Validation Requirements

-   ğŸ“‹ **Documentation** - Comprehensive function docs
-   âœ… **Testing** - High test coverage (aim for 80%+)
-   ğŸ”’ **Version control** - Track all changes
-   ğŸ“ **Change log** - Document updates
-   ğŸ·ï¸ **Releases** - Tagged versions

### Example Structure for Pharma Package

```         
mypharmapackage/
â”œâ”€â”€ DESCRIPTION          # Package metadata
â”œâ”€â”€ NAMESPACE            # Auto-generated
â”œâ”€â”€ R/                   # Function code
â”‚   â”œâ”€â”€ data_processing.R
â”‚   â”œâ”€â”€ statistical_tests.R
â”‚   â””â”€â”€ plotting.R
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ testthat/       # Unit tests
â”œâ”€â”€ vignettes/          # Long-form documentation
â”œâ”€â”€ data/               # Example datasets
â”œâ”€â”€ inst/
â”‚   â””â”€â”€ validation/     # Validation documents
â””â”€â”€ README.md
```

## Hands-On Exercise

**Build a Clinical Trial Utility Package:**

Create a package with functions for:

1.  **Subject disposition summary**
2.  **Adverse event frequency table**
3.  **Demographic summary table**

Include:

-   Proper documentation
-   Input validation
-   Unit tests
-   Examples
-   README

## Best Practices Summary

### Do's âœ…

-   Write clear, focused functions
-   Document everything with roxygen2
-   Test your functions thoroughly
-   Use meaningful names
-   Include examples
-   Keep dependencies minimal
-   Version control with git

### Don'ts âŒ

-   Don't use `library()` inside functions
-   Don't modify user's options/settings
-   Don't write to user's file system without permission
-   Don't use non-standard evaluation carelessly
-   Don't skip documentation

## Advanced Topics (Time Permitting)

-   **Vignettes** - Long-form documentation
-   **Data in packages** - Including example datasets
-   **Package dependencies** - Managing imports
-   **S3 methods** - Object-oriented programming
-   **GitHub Actions** - Automated checks

## Learning Outcomes

By the end of this workshop, you will be able to:

âœ… Create a basic R package structure\
âœ… Write package-friendly functions\
âœ… Document functions with roxygen2\
âœ… Write unit tests with {testthat}\
âœ… Share your package on GitHub\
âœ… Understand best practices for package development\
âœ… **Have created your own R package!**

## Resources for Continued Learning

-   **R Packages book** (2nd ed): [r-pkgs.org](https://r-pkgs.org)
-   **usethis documentation**: [usethis.r-lib.org](https://usethis.r-lib.org)
-   **Writing R Extensions**: Official CRAN manual
-   **Pharmaverse packages**: Examples of pharma-specific packages

## Next Steps

After this workshop:

-   Practice by packaging your existing code
-   Contribute to open-source pharma packages
-   Explore {pkgdown} for beautiful websites
-   Learn about continuous integration (GitHub Actions)
-   Join the pharmaverse community!

------------------------------------------------------------------------

### Similar Workshops
- [R Validation Discussion](r-validation-discussion.qmd) - Validation for packages
- [datasetjson](datasetjson.qmd) - Example of well-built package

### Related Presentations
- [GSK's Open Source Journey](../presentations/europe-us-sessions.qmd#gsks-journey-to-clinical-study-reporting-using-open-source) - Industry adoption

### Next Steps
- **After building:** Learn [validation](r-validation-discussion.qmd)
- **Career impact:** [Package Development skills](../summary/career-insights.qmd#3-package-development--validation)
- **Contribute:** Join [pharmaverse](https://pharmaverse.org)

------------------------------------------------------------------------

*Last updated: November 2025 \| R/Pharma 2025 Conference*